---
layout: post
title:  "如何管理控制Azure的费用和成本"
date:   2022-09-15 21:42:55 +0800--
categories: [Azure]
tags: [预算, 费用预警, 成本分析]  
---

### 1. 前言

当你用到很多Azure服务的时候, Azure的成本可能很难弄清楚, 为了避免你收到预期外的高额账单, 让我们一起看一下用于帮助控制Azure成本的工具和流程：

如何控制你的Azure成本: [https://youtu.be/G7JEz8b-G24](https://youtu.be/G7JEz8b-G24)

### 2. 预算 (Budgets)

预算是一种工具，允许用户定义在 Azure 订阅或特定资源组上花费多少钱。
为组织中的每个订阅设置总体预算至关重要。预算数字应确定每月预期支出的最高金额。
除了总体预算外，还可以针对特定应用程序来监控在其上花费了多少。每次提出新服务时，最好进行成本对话。请记住跳转到 Azure 并创建新的预算来监视该应用。

#### 2.1 订阅 - 按环境拆分成本核算

除了预算之外，在生产方案和非生产方案之间拆分成本核算也是一个好主意。这有助于诊断出现意外支出波动的原因，例如在测试站点上执行负载测试。此外，有时还有折扣可以应用于仅用于开发/测试方案的订阅。

❌不好的示例 - 没有制定预算, 也许会突然收到高额账单
![不好的示例](https://ssw.com.au/rules/static/c7c1200d37b894dd6ec1f8c746ffa8b9/2bef9/viewbudgetbad.png)

✅好的示例 - 预算已制定
![好的示例](https://ssw.com.au/rules/static/3b2318d695939214714515b25cf2552a/5d72a/viewbudget.png)

### 3. 预警 (Cost alerts)

设置预算后，预警是控制成本的下一个重要部分。预警定义在超出预算阈值时发出的通知。例如，可以将其设置为在 50%、75%、100% 和 200% 时发送预警。

确保针对对公司很重要的所有阈值设置预警。

如果公司真的担心成本，甚至可以设置 Azure Runbook 以在超出预算限制后禁用资源。但是，这不是一种非常普遍的做法，因为没有人希望公司网站随机关闭！

❌不好的示例 - 没有成本预警, 也许会突然收到高额账单
![不好的示例](https://ssw.com.au/rules/static/87c41734ad2f3158f8904b54c0e3f0a9/2bef9/budgetalertsbad.png)

✅好的示例 - 已设置✨成本预警
![好的示例](https://ssw.com.au/rules/static/3e75edcaf4ff9564d576f326686c8520/2bef9/budgetalerts.png)

### 4. 成本分析 (Cost analysis)

如果收到预警怎么办？Azure提供了一个很好的成本管理工具，称为成本分析。您可以按各种属性（例如资源组或资源类型）分析成本。

```text

非常重要: 给你的资源打上标签

```

向每个资源添加成本类别标记可以更轻松地跟踪一段时间内的成本。这样，就可以根据 Azure 资源的“核心”、“增值”还是“开发/测试”来查看这些资源的每日成本。然后，如果需要，您可以快速关闭资源以节省资金。它还可以帮助您查看资金消失的地方。

每两周运行一次报告（按成本类别选项卡分组）将突出显示资源成本的任何峰值 - 每日报告可能过于嘈杂，而月度报告可能会超支持续太久。

![按类别分列的每日费用](https://ssw.com.au/rules/static/19afcd1e654600efb3c3a5abeb1b4bc5/2bef9/azurecostsbycategory.png)